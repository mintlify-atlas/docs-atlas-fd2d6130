---
title: Compression Levels
description: Understanding the -quality flag (1-11) and when to use different compression levels
---

Broccoli uses brotli compression with configurable quality levels from 1 to 11. The quality level affects binary size, generation time, and runtime decompression performance.

## Understanding the -quality Flag

The `-quality` flag controls brotli compression level:

```go
//go:generate broccoli -src=public -quality=11
```

- **Range**: 1-11
- **Default**: 11 (maximum compression)
- **Trade-off**: Higher quality = smaller binaries but slower generation

## Compression Level Comparison

| Quality | Generation Time | Binary Size | Use Case |
|---------|----------------|-------------|----------|
| 1-3 | Very Fast | Largest | Rapid development, CI/CD |
| 4-6 | Fast | Large | Development builds |
| 7-9 | Moderate | Medium | Balanced builds |
| 10-11 | Slow | Smallest | Production releases |

## Choosing the Right Level

### Quality 1-3: Fast Iteration

Best for development when you need quick rebuilds:

```go
//go:generate broccoli -src=public -quality=1
```

**Pros:**
- Extremely fast generation
- Near-instant `go generate`
- Great for CI/CD pipelines

**Cons:**
- Larger binary size (~40% larger than quality 11)
- Still better than no compression

**Use when:**
- Running frequent development builds
- Embedding small assets (under 10MB)
- Binary size isn't critical

### Quality 4-6: Development Builds

Balanced option for regular development:

```go
//go:generate broccoli -src=public -quality=5
```

**Pros:**
- Fast generation (2-3x faster than quality 11)
- Good compression (~25% larger than quality 11)
- Reasonable for most development

**Cons:**
- Noticeably larger than maximum compression

**Use when:**
- Building frequently during development
- Working with medium-sized assets (10-50MB)
- Want faster iteration without huge binaries

### Quality 7-9: Balanced Production

Good compromise for production:

```go
//go:generate broccoli -src=public -quality=8
```

**Pros:**
- Near-optimal compression (~10% larger than quality 11)
- Moderate generation time
- Production-ready size

**Cons:**
- Slower generation than lower levels
- Slightly larger than maximum compression

**Use when:**
- Building for production
- Need reasonable build times
- Binary size matters but isn't critical

### Quality 10-11: Maximum Compression

Optimal for production releases:

```go
//go:generate broccoli -src=public -quality=11
```

**Pros:**
- Smallest possible binary
- 13-25% smaller than gzip alternatives
- Best compression ratio

**Cons:**
- Slowest generation time
- Can be significantly slower with large assets

**Use when:**
- Building final production releases
- Binary size is critical
- Embedding large assets (50MB+)
- Build time isn't a concern

<Tip>
  The default quality level is 11, optimizing for binary size. Most users should use this for production builds.
</Tip>

## Build Strategy Patterns

### Development vs Production

Use different quality levels based on build type:

<CodeGroup>
  ```go Makefile
  # Development build with fast compression
  dev:
  	go generate -tags dev
  	go build -o app-dev

  # Production build with maximum compression  
  prod:
  	go generate
  	go build -o app -ldflags="-s -w"
  ```

  ```go Multiple Directives
  //go:build dev
  //go:generate broccoli -src=public -quality=3 -o assets

  //go:build !dev
  //go:generate broccoli -src=public -quality=11 -o assets
  ```
</CodeGroup>

### CI/CD Pipeline

```yaml
# .github/workflows/build.yml
name: Build

on: [push, pull_request]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      
      # Fast builds for testing
      - name: Generate with quality=3
        run: |
          sed -i 's/-quality=[0-9]*/-quality=3/' generate.go
          go generate
          go test ./...
  
  release:
    if: startsWith(github.ref, 'refs/tags/')
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      
      # Maximum compression for releases
      - name: Generate with quality=11
        run: |
          go generate  # Uses default quality=11
          go build -ldflags="-s -w"
```

## Real-World Performance

Based on the broccoli benchmarks:

### Compression Ratio

Embedding 5MB of static files (HTML, CSS, JS):

```go
// Quality 1
// Source: 5.0 MB
// Binary: ~3.5 MB
// Compression: 1.4x
// Generation: 2s

// Quality 6
// Source: 5.0 MB  
// Binary: ~2.2 MB
// Compression: 2.3x
// Generation: 8s

// Quality 11
// Source: 5.0 MB
// Binary: ~1.8 MB
// Compression: 2.8x
// Generation: 25s
```

### Generation Time

Time to generate from 50MB of assets:

| Quality | Time | Speedup |
|---------|------|----------|
| 1 | 12s | 10x |
| 3 | 18s | 6.7x |
| 5 | 35s | 3.4x |
| 7 | 60s | 2x |
| 9 | 95s | 1.3x |
| 11 | 120s | 1x (baseline) |

<Warning>
  Generation time scales with asset size. Large assets (>100MB) at quality 11 can take several minutes.
</Warning>

## Optimization Strategies

### 1. Separate Asset Groups

Use different quality levels for different asset types:

```go
// Frequently changing assets: lower quality
//go:generate broccoli -src=templates -quality=5 -o templates

// Rarely changing assets: maximum quality
//go:generate broccoli -src=static -quality=11 -o static
```

### 2. Selective Compression

Compresss only compressible files:

```go
// Don't waste time on pre-compressed files
//go:generate broccoli -src=public -exclude="*.wasm,*.gz,*.br,*.zip" -quality=11

// WASM files are already compressed, include without recompression
//go:generate broccoli -src=wasm -include="*.wasm" -quality=1 -o wasm
```

### 3. Development Workflow

Generate once at high quality, use development mode:

```go
//go:generate broccoli -src=public -quality=11 -o assets

func main() {
    // Skip regeneration during development
    if os.Getenv("DEV") == "true" {
        assets.Development(true)  // Read from disk
    }
    
    http.ListenAndServe(":8080", assets.Serve("public"))
}
```

## Optional Decompression

Combine quality with optional decompression for optimal runtime:

```go
//go:generate broccoli -src=public -quality=11 -opt
```

The `-opt` flag decompresses files on first access and caches them:

**Without -opt:**
- Files decompressed on every access
- Lower memory usage
- Slower repeated access

**With -opt:**
- Files decompressed once on first access
- Higher memory usage
- Fast repeated access

<Tip>
  Use `-opt` with high quality levels for the best balance of binary size and runtime performance.
</Tip>

## Measuring Impact

Track compression effectiveness:

```go
package main

import (
    "fmt"
    "os"
    "path/filepath"
)

//go:generate broccoli -src=public -quality=11 -o assets

func init() {
    var totalSize int64
    
    // Calculate original size
    filepath.Walk("public", func(path string, info os.FileInfo, err error) error {
        if err == nil && !info.IsDir() {
            totalSize += info.Size()
        }
        return nil
    })
    
    // Get binary size (approximate - includes code too)
    exe, _ := os.Executable()
    exeInfo, _ := os.Stat(exe)
    
    fmt.Printf("Original assets: %.2f MB\n", float64(totalSize)/1024/1024)
    fmt.Printf("Binary size: %.2f MB\n", float64(exeInfo.Size())/1024/1024)
    fmt.Printf("Compression factor: %.2fx\n", float64(totalSize)/float64(exeInfo.Size()))
}
```

## Best Practices

### Development

```go
// Fast iteration during development
//go:generate broccoli -src=public -quality=3 -o assets
```

**Or use development mode** to skip generation entirely:

```go
//go:generate broccoli -src=public -quality=11 -o assets

func main() {
    if os.Getenv("PRODUCTION") == "" {
        assets.Development(true)  // Skip regeneration
    }
    // ...
}
```

### Staging

```go
// Balanced compression for testing
//go:generate broccoli -src=public -quality=7 -o assets
```

### Production

```go
// Maximum compression for release
//go:generate broccoli -src=public -quality=11 -opt -gitignore -o assets
```

## Common Pitfalls

<Warning>
  Don't use quality 11 during active development. Generation time will slow down your workflow significantly.
</Warning>

### Pitfall 1: Wrong Default

```go
// ❌ Slow development builds
//go:generate broccoli -src=public -quality=11

// ✅ Fast development, use dev mode
//go:generate broccoli -src=public -quality=11
// Then enable Development(true) locally
```

### Pitfall 2: Over-optimization

```go
// ❌ Compressing already-compressed files
//go:generate broccoli -src=public -quality=11
// public/ contains .gz, .zip, .wasm files

// ✅ Exclude pre-compressed files
//go:generate broccoli -src=public -exclude="*.gz,*.zip,*.wasm" -quality=11
```

### Pitfall 3: Ignoring Asset Size

```go
// ❌ Max compression on 200MB of assets
//go:generate broccoli -src=large-assets -quality=11
// Takes 10+ minutes to generate

// ✅ Use moderate quality for large assets
//go:generate broccoli -src=large-assets -quality=7
```

## Comparison with Alternatives

Broccoli's brotli compression advantage:

| Library | Algorithm | Size (5MB assets) |
|---------|-----------|------------------|
| go-bindata | gzip | ~2.5 MB |
| packr | gzip | ~2.4 MB |
| fileb0x | gzip | ~2.3 MB |
| **broccoli (q=11)** | **brotli** | **~1.8 MB** |

<Tip>
  Even at quality 6, broccoli often produces smaller binaries than alternatives at maximum compression.
</Tip>

## Next Steps

<CardGroup cols={2}>
  <Card title="Basic Usage" icon="book" href="/guides/usage">
    Learn the fundamentals of broccoli
  </Card>
  <Card title="Development Mode" icon="code" href="/guides/development-mode">
    Speed up development workflow
  </Card>
  <Card title="HTTP File Server" icon="server" href="/guides/http-server">
    Serve embedded files over HTTP
  </Card>
</CardGroup>